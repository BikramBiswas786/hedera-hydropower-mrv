require("dotenv").config();
const AIGuardianVerifier = require("../src/ai-guardian-verifier");

console.log("# AI-Assisted Verification - LIVE PROOF\n");
console.log("Running ENGINE V1 code\n---\n");

function gen(id,ts,q){const b={kwh:450,f:15,h:80};let k,f,hh,p,t;if(q==="perfect"){k=b.kwh;f=b.f;hh=b.h;p=7.2;t=2}else if(q==="good"){k=b.kwh+Math.random()*20-10;f=b.f+Math.random()*0.5-0.25;hh=b.h+Math.random()*2-1;p=7.2+Math.random()*0.3-0.15;t=2+Math.random()}else{k=b.kwh*2.5;f=b.f;hh=b.h;p=7.2;t=2}return{turbineId:id,periodStart:new Date(ts-3600000).toISOString(),periodEnd:new Date(ts).toISOString(),generatedKwh:k,flowRate:f,headHeight:hh,pH:p,turbidity:t,anomalyFlag:false,signature:"demo-sig",publicKey:"demo-key",timestamp:new Date(ts).toISOString()}}

async function demo15(){console.log("## Demo 1: 15 Turbines, Daily\n");const v=new AIGuardianVerifier({verifierId:"did:verifier-demo",verifierPrivateKey:null});const b=[];const n=Date.now();for(let h=0;h<24;h++){for(let t=1;t<=15;t++){const q=Math.random()<0.98?"good":"anomaly";b.push(gen(`did:turbine-${t.toString().padStart(3,"0")}`,n-h*3600000,q))}}console.log(`Generated: ${b.length} records\n`);const r=await v.verifyPeriodBatch(b,{});console.log("**AI Result**:");console.log(`- Auto-approved: ${r.auto_approved} (${(r.auto_approved/b.length*100).toFixed(1)}%)`);console.log(`- Flagged: ${r.flagged}\n`);const ah=b.length*2;const ai=r.auto_approved*0.02+r.flagged*2;console.log("**Cost**:");console.log(`- All manual: $${ah.toFixed(2)}`);console.log(`- AI-assisted: $${ai.toFixed(2)}`);console.log(`- Savings: ${((ah-ai)/ah*100).toFixed(1)}%\n---\n`)}

async function demo1000(){console.log("## Demo 2: 1000 Turbines, Monthly\n");const v=new AIGuardianVerifier({verifierId:"did:verifier-demo",verifierPrivateKey:null});const bs=1000*720;console.log(`Simulating ${bs.toLocaleString()} records...\n`);const b=[];const n=Date.now();for(let i=0;i<1000;i++){const id=`did:turbine-${(i%1000+1).toString().padStart(4,"0")}`;const q=Math.random()<0.98?"good":"anomaly";b.push(gen(id,n-i*3600000,q))}const r=await v.verifyPeriodBatch(b,{});const rate=r.auto_approved/b.length;const fa=Math.floor(bs*rate);const ff=bs-fa;console.log(`Sample: ${r.auto_approved} approved\n`);console.log("**Extrapolated to 720,000**:");console.log(`- Approved: ${fa.toLocaleString()}`);console.log(`- Flagged: ${ff.toLocaleString()}\n`);const ah=bs*2;const ai=fa*0.02+ff*2;console.log(`- All manual: $${ah.toLocaleString()}`);console.log(`- AI-assisted: $${ai.toLocaleString()}`);console.log(`- Savings: ${((ah-ai)/ah*100).toFixed(1)}%\n---\n`)}

async function main(){console.log("# LIVE AI PROOF\n");await demo15();await demo1000();console.log("## Evidence\n- Complete: evidence/COMPLETE-EVIDENCE.md (472 txns)\n- HashScan: https://hashscan.io/testnet/account/0.0.6255927\n- Audit: https://hashscan.io/testnet/topic/0.0.7462600 (356 msgs)\n")}main().catch(console.error);
